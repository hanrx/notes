
# 1.1 初识微服务


## 1.1.1 什么是微服务

“微服务”是软件架构大师Martin Fowler提出来的，但至今为止其都没有一个确切的定义。只有在Martin Fowler的官方网站上给出了一段关于微服务框架的说明。该段说明原文如下：
>In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery. There is a bare minimum of centralized management of these services, which may be written in different programming languages and use different data storage technologies.
                                                                                              
简单来讲，微服务架构风格是**将一个单体的应用程序开发拆解为一组“小”的服务**，值得注意的是，这里所说的“小”是**以业务边界来区分**的，而不是根据代码的多少来区分的。**每个服务都运行在一个单独的进程中**，服务之间**通过轻量级的机制进行通信**，例如使用HTTP资源接口：每个服务都可以**通过全自动化的部署机制来独立部署**；微服务中的各个服务**可以以多种语言来编写**，但是在实际开发中，由于各个公司的技术栈有限，通常会指定一门擅长的技术语言，例如Java；每个服务都可以使用不同数据存储技术，例如MySQL、Cassandra及MongoDB等，但是为了统一，通常各个服务还是会选用同一种存储技术。


## 1.1.2 为什么需要微服务

为什么需要微服务？通常会将微服务架构和单体架构进行比较。二者架构图对比如图1-1所示。
![](images/1.1.2.1.png)
左边是单体架构图，右边是微服务架构图。传统的**单体架构图主要包括三部分：一个展示层**，用于将一些信息展示给客户端人员或者为客户端人员提供一些交互页面；**一个数据存储层，通常就是提供一个数据库**，用于存储一些需要持久化的数据；最后一个部分，**是一个服务端的应用程序，该程序主要用于处理请求、执行业务逻辑、操作数据库，以及将相关结果返回给前端等**。在该架构中，**所有的请求都在一个进程中处理，而且水平扩展也很简单，只需要多添加几台部署了该服务的机器，之后再这些服务器的前边部署一台负载均衡器就可以了**。

**单体架构有这么几个问题**：首先，由于所有的业务逻辑都写在了一个应用server中，因此**只要对该Service进行修改**，哪怕只是添加一行代码，也**需要编译打包部署整个应用**，需要的时间会比较久，耗时耗力；其次，**假设整个应用只有一个接口到达了瓶颈，我们想要水平扩展该接口，这个时候只能通过水平扩展整个应用来达到目的**；最后，随着应用程序规模增加，即使我们使用Maven进行模块化开发，也**很难保证对一个模块的修改不会影响其他模块**。

为了解决这些问题，微服务架构出现了！在微服务架构中，**我们将一个整体应用切分成多个小的服务，这些小的服务可以独立部署并且每个服务运行在自己的进程中，所以如果修改了一个服务的代码，那么我们只需要单独部署该服务就行，而且如果需要水平扩展一个服务的接口，只扩展该服务就可以了**。

    
## 1.1.3 微服务架构的缺点

微服务架构可以解决这么多的问题，那么它有什么缺点吗？
    
首先，由于微服务**将一个整体应用拆解成了一系列的服务**，这样不可避免地就**会在不同的服务中存在一些冗余代码**，例如，如果server1和server2中都用到了Redis集群，可能就需要在两个service中都编写一个RedisCluster的工具类，而这个工具类的代码几乎是一模一样的。
    
微服务架构的使用使原本的一个应用程序变为几十甚至几百个服务。**维护一个应用程序简单，但是维护几十甚至几百个服务就不是那么简单了**，所以**需要配备功底较深厚的运维人员**，也需要**搭建完善的运维系统**，例如，完善的计数监控系统、完善的日志系统以及完善的链路跟踪系统等。
    
在微服务架构中，服务众多，**服务之间的调用也由原来的单体架构中的进程内调用变为了进程之间调用**，这就需要考虑很多问题，例如使用什么**通信方式**，如何处理**网络延迟及服务容错等**问题。这是分布式系统都会存在的问题，但是在微服务架构中这些问题尤其严重，因为“分布”得非常厉害。既然是分布式系统，就还存在一个很大的问题：**分布式事务处理**。分布式事务的解决方式虽然比较多，但是几乎没有十全十美的方式。**通常会使用补偿方式**。
    
另外，如果从零开始搭建一套微服务系统，那么**需要掌握的组件技术会比较多**，从而**开发的难度较大，开发周期会比较长**。在开源世界中有一个比较好的微服务架构：Spring Cloud。但是如果使用Spring Cloud，可定制性就远不如自己搭建的微服务系统。另外，**即使使用Spring Cloud，一些系统还是需要自己搭建，比如日志系统、计数监控系统等。这都需要具有一定的技术功底**。

最后，采用微服务架构就会涉及怎样将一个整**体应用拆分成多个微服务，我们说了拆分的原则是根据业务拆分，但是这个业务边界有时候是比较难划分的**。这个时候就需要有一个超牛的架构师来做这个事儿了。










































