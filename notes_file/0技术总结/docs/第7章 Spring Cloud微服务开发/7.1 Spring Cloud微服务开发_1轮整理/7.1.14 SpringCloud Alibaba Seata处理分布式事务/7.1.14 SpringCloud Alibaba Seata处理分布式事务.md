# 分布式事务问题
* 分布式前：单机库没这个问题。从1:1 -> 1:N -> N:N。
* 分布式之后：
  > 单体由应用被拆分成微服务应用，原来的三个模块被拆分成三个独立的应用，分别使用三个独立的数据源，业务操作需要调用三个服务来完成。此时每个服务内部的
  > 数据一致性由本地事务来保证，但是全局的数据一致性问题没法保证。
  > 
  > 如：用户购买商品的业务逻辑，整个业务逻辑由3个微服务提供支持：
  >   * 仓储服务：对给定的商品扣除仓储数量。
  >   * 订单服务：根据采购需求创建订单。
  >   * 账户服务：从用户账户中扣除余额。
  > ![img.png](img.png)
* 一句话：一次业务操作需要跨多个数据源或需要跨多个系统进行远程调用，就会产生分布式事务问题

# Seata简洁
  * 是什么：
    * Seata是一款开源的分布式事务解决方案，致力于在微服务框架下提供高性能和简单易用的分布式事务服务
    * 官网地址：http://seata.io/zh-cn/  
  * 能干嘛：
    * 一个典型的分布式事务过程：
      * 分布式事务处理过程-ID+三组件模型：
        * Transaction ID(XID)：全局唯一的事务id
        * 三组件概念：
          * Transaction Coordinator(TC)：事务协调器，维护全局事务的运行状态，负责协调并驱动全局事务的提交或回滚。
          * Transaction Manager(TM):控制全局事务的边界，负责开启一个全局事务，并最终发起全局提交或全局回滚的决议。
          * Resource manager(RM)：控制分支事务，负责分支注册、状态汇报，并接受事务协调的指令，驱动分支（本地）事务的提交和回滚。
      * 处理过程：
        * 1.TM向TC申请开启一个全局事务，全局事务创建成功并生成一个全局唯一的XID；
        * 2.XID在微服务调用链路的上下文中传播；
        * 3.RM向TC注册分支事务，将其纳入XID对应全局事务的管辖；
        * 4.TM向TC发起针对XID的全局提交或回滚决议；
        * 5.TC调度XID下管辖的全部分支事务完成提交或回滚请求。
        > ![img_1.png](img_1.png)
  * 哪儿下：发布说明：https://github.com/seata/seata/releases
  * 怎么玩：
    * 本地：@Transational
    * 全局：@GlobalTranstional：
    > seata的分布式交易解决方案：
    > ![img_2.png](img_2.png)

# Seata-Server安装
* 1.官网地址：https://seata.io/zh-cn/
* 2.下载版本
* 3.seata-server-0.9.0.zip解压到指定目录并修改conf目录下的file.conf配置文件：
  * 先备份原始file.conf文件
  * 主要修改：自定义事务组名称+事务日志存储模式为db+数据库连接  
  * file.conf：
    * service模块：
      > ![img_3.png](img_3.png)
    * store模块：  
      > ![img_4.png](img_4.png)
      > ![img_5.png](img_5.png)
* 4.mysql5.7数据库新建库seata：建表db_store.sql在seata-server-0.9.0\seata\conf目录里面。
* 5.在seata库里面新建表。
* 6.修改seata-server-0.9.0\seata\conf目录下的registry.conf目录下的registry.cong配置文件：
  > ![img_6.png](img_6.png)
* 7.先启动Nacos端口号8848
* 8.再启动seata-server：seata-server-0.9.0\seata\bin : seata-server.bat


# 订单/库存/账户业务数据库准备



# 订单/库存/账户业务微服务准备



# Test


# 一部分补充





































