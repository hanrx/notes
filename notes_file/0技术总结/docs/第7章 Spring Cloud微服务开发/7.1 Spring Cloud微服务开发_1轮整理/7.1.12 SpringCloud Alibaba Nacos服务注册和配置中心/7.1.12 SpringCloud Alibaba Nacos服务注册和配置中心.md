# Nacos简介
* 为什么叫Nacos：前四个字母为Nameing和Configuration的前两个字母，最后的s为Service。
* 是什么：
  * 一个更易于构建原生应用的动态服务发现、配置管理和服务管理平台。
  * Nacos：Dynamic Naming and Configuration Service
  * Nacos就是注册中心+配置中心的组合：等价于Nacos=Eureka+Config+bus
* 能干嘛：
  * 替代Eureka做服务注册中心。
  * 替代Config做服务配置中心。  
* 去哪下：
  * https://github.com/alibaba/Nacos
  * 官网文档：
    * https://nacos.io/zh-ch/
    * https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_nacos_discovery
* 各种注册中心对比：
  > ![img.png](img.png)
# 安装并运行Nacos
* 本地Java8+Maven环境已经OK
* 先从官网下载Nacos：https://github.com/alibaba/nacos/releases:1.1.4
* 解压安装包，直接运行bin目录下的startup.cmd：默认账户和密码是nacos
* 命令运行成功后直接访问http://localhost:8848/nacos
* 结果页面：
  > ![img_1.png](img_1.png)

# Nacos作为服务注册中心演示
* 官网文档：https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery
* 基于Nacos的服务提供者：
  * 新建Module：cloudalibaba-provider-payment9001
  * POM：
    * 父POM:
      > ![img_2.png](img_2.png)
    * 本模块POM:
      > ![img_3.png](img_3.png)
  * YML：
    > ![img_4.png](img_4.png)
  * 主启动类
  * 业务类：PaymentController：
    > ![img_5.png](img_5.png)
  * 测试：
    * http://localhost:9001/payment/nacos/1
    * nacos控制台：
      > ![img_6.png](img_6.png)
    * nacos服务注册中心+服务提供者9001都ok了
  * 为了下一章节演示nacos的负载均衡，参照9001新建9002:
    * 新建cloudalibaba-provider-payment9002
    * 9002其他步骤你懂得。
    * 或者取巧，直接拷贝虚拟端口映射：
      > ![img_7.png](img_7.png)
* 基于Nacos的服务消费者：
  * 新建Module：cloudalibaba-consumer-nacos-order83
  * POM：
    > ![img_8.png](img_8.png) 
    > 为什么nacos支持负载均衡：
    > ![img_9.png](img_9.png)
  * YML:
    > ![img_10.png](img_10.png)
  * 主启动类：
  * 业务类：
    * ApplicationContextBean：
      > ![img_11.png](img_11.png)
    * OrderNacosController:
      > ![img_12.png](img_12.png)
  * 测试：
    * nacos控制台：
      > ![img_13.png](img_13.png)
    * http://localhost:83/consumer/payment/nacos/13:83访问9001/9002，负载均衡OK  
* 服务注册中心对比：
  * 各种注册中心对比：
    * Nacos全景图展示:
      > ![img_14.png](img_14.png)
      > ![img_15.png](img_15.png)
    * Nacos和其他注册中心对比：
      > ![img_16.png](img_16.png)
      > ![img_17.png](img_17.png)
    * 切换：Nacos支持AP和CP模式的切换：
      > C是所有节点在同一时间看到的数据是一致的；而A的定义是所有的请求都会收到响应。
      > 
      > 何时选择使用何种模式？
      > 一般来说，
      > 如果不需要存储服务级别的信息且服务实例是通过nacos-client注册，并能够保持心跳上报，那么就可以选择AP模式。当前主流的服务如Spring cloud和
      > Dubbo服务，都适用于AP模式，AP模式为服务的可能性而减弱了一致性，因此AP模式下只支持注册临时实例。
      > 
      > 如果需要在服务级别编辑或者存储配置信息，那么CP是必须的，K8S服务和DNS服务则适用于CP模式。
      > CP模式下则支持注册持久化实例，此时则是以Raft协议为集群运行模式，该模式下注册实例之前必须先注册服务，如果服务不存在，则会返回错误。
      > 
      > curl -X PUT '$NACOS_SERVER:8848/nacos/vi/ns/operator/switches?entry=serverMode&value=CP'
# Nacos作为服务配置中心演示
* Nacos作为配置中心-基础配置：
  
* Nacos作为配置中心-分类配置：




# Nacos集群和持久化配置（重要）























